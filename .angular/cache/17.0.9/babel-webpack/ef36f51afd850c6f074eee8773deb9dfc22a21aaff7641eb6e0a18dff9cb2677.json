{"ast":null,"code":"import _asyncToGenerator from \"E:/my-projects/Example_project/grocery-app/grocery-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Capacitor } from '@capacitor/core';\nimport { CapacitorVideoPlayer } from 'capacitor-video-player';\nimport * as WebVPPlugin from 'capacitor-video-player';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../vedioservice.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@ionic/angular\";\nconst _c0 = [\"video\"];\nfunction HomePage_ion_list_8_ion_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\", 9);\n    i0.ɵɵlistener(\"click\", function HomePage_ion_list_8_ion_item_1_Template_ion_item_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const video_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.play(video_r3));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const video_r3 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", video_r3, \" \");\n  }\n}\nfunction HomePage_ion_list_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-list\");\n    i0.ɵɵtemplate(1, HomePage_ion_list_8_ion_item_1_Template, 2, 1, \"ion-item\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.videos);\n  }\n}\nexport let HomePage = /*#__PURE__*/(() => {\n  var _class;\n  class HomePage {\n    constructor(videoService, changeDetector) {\n      this.videoService = videoService;\n      this.changeDetector = changeDetector;\n      this.isRecording = false;\n      this.videos = [];\n    }\n    ngAfterViewInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.videos = yield _this.videoService.loadVideos();\n        // Initialise the video player plugin\n        if (Capacitor.isNative) {\n          _this.videoPlayer = CapacitorVideoPlayer;\n        } else {\n          _this.videoPlayer = WebVPPlugin.CapacitorVideoPlayer;\n        }\n      })();\n    }\n    recordVideo() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        // Create a stream of video capturing\n        const stream = yield navigator.mediaDevices.getUserMedia({\n          video: {\n            facingMode: 'user'\n          },\n          audio: true\n        });\n        // Show the stream inside our video object\n        _this2.captureElement.nativeElement.srcObject = stream;\n        var options = {\n          mimeType: 'video/webm'\n        };\n        _this2.mediaRecorder = new MediaRecorder(stream, options);\n        let chunks = [];\n        // Store the video on stop\n        _this2.mediaRecorder.onstop = /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (event) {\n            const videoBuffer = new Blob(chunks, {\n              type: 'video/webm'\n            });\n            yield _this2.videoService.storeVideo(videoBuffer);\n            // Reload our list\n            _this2.videos = _this2.videoService.videos;\n            _this2.changeDetector.detectChanges();\n          });\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }();\n        // Store chunks of recorded video\n        _this2.mediaRecorder.ondataavailable = event => {\n          if (event.data && event.data.size > 0) {\n            chunks.push(event.data);\n          }\n        };\n        // Start recording wth chunks of data\n        _this2.mediaRecorder.start(100);\n        _this2.isRecording = true;\n      })();\n    }\n    stopRecord() {\n      this.mediaRecorder.stop();\n      this.mediaRecorder = null;\n      this.captureElement.nativeElement.srcObject = null;\n      this.isRecording = false;\n    }\n    play(video) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        // Get the video as base64 data\n        const realUrl = yield _this3.videoService.getVideoUrl(video);\n        // Show the player fullscreen\n        yield _this3.videoPlayer.initPlayer({\n          mode: 'fullscreen',\n          url: realUrl,\n          playerId: 'fullscreen',\n          componentTag: 'app-home'\n        });\n      })();\n    }\n  }\n  _class = HomePage;\n  _class.ɵfac = function HomePage_Factory(t) {\n    return new (t || _class)(i0.ɵɵdirectiveInject(i1.VedioserviceService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n  };\n  _class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _class,\n    selectors: [[\"app-home\"]],\n    viewQuery: function HomePage_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.captureElement = _t.first);\n      }\n    },\n    decls: 12,\n    vars: 3,\n    consts: [[\"color\", \"primary\"], [\"autoplay\", \"\", \"playsinline\", \"\", \"muted\", \"\", 1, \"video\", 3, \"hidden\"], [\"video\", \"\"], [\"id\", \"fullscreen\", \"slot\", \"fixed\"], [4, \"ngIf\"], [\"vertical\", \"bottom\", \"horizontal\", \"center\", \"slot\", \"fixed\"], [3, \"click\"], [3, \"name\"], [\"tappable\", \"\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"tappable\", \"\", 3, \"click\"]],\n    template: function HomePage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\", 0)(2, \"ion-title\");\n        i0.ɵɵtext(3, \" Capture Videos \");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(4, \"ion-content\");\n        i0.ɵɵelement(5, \"video\", 1, 2)(7, \"div\", 3);\n        i0.ɵɵtemplate(8, HomePage_ion_list_8_Template, 2, 1, \"ion-list\", 4);\n        i0.ɵɵelementStart(9, \"ion-fab\", 5)(10, \"ion-fab-button\", 6);\n        i0.ɵɵlistener(\"click\", function HomePage_Template_ion_fab_button_click_10_listener() {\n          return ctx.isRecording ? ctx.stopRecord() : ctx.recordVideo();\n        });\n        i0.ɵɵelement(11, \"ion-icon\", 7);\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"hidden\", !ctx.isRecording);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isRecording);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"name\", ctx.isRecording ? \"stop\" : \"videocam\");\n      }\n    },\n    dependencies: [i2.NgForOf, i2.NgIf, i3.IonContent, i3.IonFab, i3.IonFabButton, i3.IonHeader, i3.IonIcon, i3.IonItem, i3.IonList, i3.IonTitle, i3.IonToolbar],\n    styles: [\"#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}\"]\n  });\n  return HomePage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}